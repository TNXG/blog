<!-- 尾部脚本 -->
<script>
    window.addEventListener('load', async () => {
        if (window.localStorage.getItem('ClientWorkerInstall') === 'true' && window.localStorage.getItem('ClientWorkerConfig') !== 'true') {
            await fetch('/cw-cgi/api?type=config').then(res => res.text())
                .then(res => {
                    if (res === 'ok') {
                        window.localStorage.setItem('ClientWorkerConfig', 'true')
                        window.location.reload()
                    } else {
                        console.error(`ClientWorkerConfig Error:${res}`)
                    }
                })
        } else {
            navigator.serviceWorker.register(`/cw.js?time=${new Date().getTime()}`)
                .then(async reg => {
                    if (window.localStorage.getItem('ClientWorkerConfig') === 'true') return;
                    console.log('ClientWorker Installed,Need to reload page to Config!')
                    window.localStorage.setItem('ClientWorkerInstall', 'true');
                    setTimeout(() => {
                        window.location.search = `?time=${new Date().getTime()}` //#1
                    }, 200)
                }).catch(err => {
                    console.error(`ClientWorker Install Failed:${err}`)
                })
        }
    });
</script>
<script type="text/javascript">
    (function (c, l, a, r, i, t, y) {
        c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
        t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
        y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
    })(window, document, "clarity", "script", "bdwnhd5bw9");
</script>